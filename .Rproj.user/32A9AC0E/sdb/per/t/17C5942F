{
    "contents" : "#Run \"understory_data_prep.R\" first!\nlibrary(\"MuMIn\")\nlibrary(\"lme4\")\nlibrary(\"car\")\nlibrary(\"glmmADMB\")\nlibrary(\"effects\")\nlibrary(\"plyr\")\nlibrary(\"lmerTest\")\n\nplot_data <- plot_data[!(plot_data$Plot %in% c(\"NPELECTRICEEL\", \"NPELECTRICEEL120\",\n                                           \"NPELECTRICEEL240\", \"NPELECTRICEEL360\")), ]\nplot_data$Cluster <- droplevels(plot_data$Cluster)\n\n#exploration\nhist(asin(sqrt(plot_data$Cheatgrass/100)))\nhist(log(plot_data$Cheatgrass/100 + .01))\n\nnrow(plot_data[plot_data$Cheatgrass != 0, ])\n\nhist(asin(sqrt(plot_data$Pgrass/100)))\nnrow(plot_data[plot_data$Pgrass != 0, ])\n\nhist(asin(sqrt(plot_data$Pforb/100)))\nnrow(plot_data[plot_data$Pforb != 0, ])\n\nhist(asin(sqrt(plot_data$Shrub_cover_li)))\nnrow(plot_data[plot_data$Shrub_cover_li != 0, ])\n\nplot(plot_data$Cheatgrass ~ plot_data$cwd_normal_cum)\n\n#---------------------------------------------------------------\n#linear mixed effects models for functional groups at plot level\n#-------------------------------------------------------------------\n\n## Cheatgrass\n\ncheatgrass_plot <- lmer(log(Cheatgrass/100 + .01) ~ scale(Tree_cover) + scale(Dead_ba)*scale(cwd_normal_cum) +\n                          scale(AWC) + scale(Avg_depth) + scale(Dead_ba)*scale(cwd_normal_cum) + (1|Cluster), data = plot_data, \n                        na.action = na.fail)\nsummary(cheatgrass_plot, ddf = \"Kenward-Roger\")\nr.squaredGLMM(cheatgrass_plot)\nplot(allEffects(cheatgrass_plot, partial.residuals = TRUE))\nplot(cheatgrass_plot)\nAICc(cheatgrass_plot)\nscatter.smooth(residuals(cheatgrass_plot) ~ predict(cheatgrass_plot))\n\ncgrass_set <- dredge(cheatgrass_plot)\nhead(cgrass_set)\n\ncg_model <- lmer(log(Cheatgrass/100 + .01) ~ scale(Delta_pdc)*scale(cwd_normal_cum) + (1|Cluster), data = plot_data, \n                 na.action = na.fail)\nsummary(cg_model, ddf = \"Kenward-Roger\")\nr.squaredGLMM(cg_model)\n\n## Perr grass\n\npgrass_plot <- lmer(log(Pgrass/100+.01) ~ scale(Tree_cover) + scale(Dead_ba)*scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                      scale(AWC) + scale(Avg_depth) + scale(Dead_ba)*scale(cwd_normal_cum) + scale(Dead_rat) + (1|Cluster), data = plot_data, \n                    na.action = na.fail)\nsummary(pgrass_plot, ddf = \"Kenward-Roger\")\nr.squaredGLMM(pgrass_plot)\nplot(allEffects(pgrass_plot, partial.residuals = TRUE))\nplot(pgrass_plot)\n\npgrass_set <- dredge(pgrass_plot)\nhead(pgrass_set)\n\npg_model <- lmer(log(Pgrass/100) ~ (1|Cluster), data = plot_data, na.action = na.fail)\nsummary(pg_model)\nr.squaredGLMM(pg_model)\n\n## Perr forbs\n\npforb_plot <- lmer(log(Pforb/100+.01) ~ scale(Tree_cover)  + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                     scale(AWC) + scale(Avg_depth) + scale(Dead_ba)*scale(cwd_normal_cum) + (1|Cluster), data = plot_data, \n                   na.action = na.fail)\nsummary(pforb_plot, ddf = \"Kenward-Roger\")\nr.squaredGLMM(pforb_plot)\nplot(allEffects(pforb_plot, partial.residuals = TRUE))\nplot(pforb_plot)\n\npforb_set <- dredge(pforb_plot)\nhead(pforb_set)\n\npf_model <- lmer(log(Pforb/100 +.01) ~ (1|Cluster), data = plot_data, na.action = na.fail)\nsummary(pf_model)\nr.squaredGLMM(pf_model)\n\n## Shrubs\nshrub_plot <- lmer(log(Shrub_cover_li + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                     scale(AWC) + scale(Avg_depth) + scale(Dead_ba)*scale(cwd_normal_cum) + (1|Cluster), data = plot_data, \n                   na.action = na.fail)\nsummary(shrub_plot, ddf = \"Kenward-Roger\")\nr.squaredGLMM(shrub_plot)\nplot(allEffects(shrub_plot, partial.residuals = TRUE))\nplot(shrub_plot)\n\nshrub_set <- dredge(shrub_plot)\nhead(shrub_set)\n\nshrub_model<- lmer(log(Shrub_cover_li + .01) ~ scale(Tree_cover) + (1|Cluster), data = plot_data, \n                   na.action = na.fail)\nsummary(shrub_model)\nr.squaredGLMM(shrub_model)\nplot(allEffects(shrub_model, partial.residuals = TRUE))\n\n## presence/absence of cheatgrass\ncg_pa <- glmer(ifelse(plot_data$Cheatgrass == 0, 0, 1) ~ scale(Live_ba) + scale(Delta_pdc) + scale(cwd_normal_cum) +\n                scale(AWC) + (1|Cluster), \n               family = \"binomial\",\n               link = \"logit\",\n               data = plot_data)\nsummary(cg_pa)\n\n\n\n#-----------------------------------------------\n# Comparison of greenwood and 2015\n#-----------------------------------------------\ncompare <- join(plot_daub_cover, greenwood_under, by = \"Plot\", type = \"inner\")\ncompare <- join(compare, tcover[, c(\"Plot\", \"Tree_cover\", \"Shrub_cover_li\")], by = \"Plot\", type = \"inner\")\ncompare <- join(compare, plot_data[, c(\"Plot\", \"Dead_ba\", \"Delta_pdc\", \"cwd_normal_cum\")], by = \"Plot\")\n\n#cheatgrass\nplot(compare$Cheatgrass ~ compare$Cheatgrass.Cover)\nsummary(lm(compare$Cheatgrass ~ compare$Cheatgrass.Cover + 0))\ncor.test(compare$Cheatgrass, compare$Cheatgrass.Cover,\n         method = c(\"spearman\"), exact = FALSE)\nboxplot(compare$Cheatgras-compare$Cheatgrass.Cover)\nmean(compare$Cheatgrass-compare$Cheatgrass.Cover)\nwilcox.test(compare$Cheatgrass, compare$Cheatgrass.Cover, paired = TRUE, alternative=\"greater\")\nt.test(compare$Cheatgrass, compare$Cheatgrass.Cover, paired = TRUE, alternative=\"greater\")\n\ncor.test(compare$Cheatgrass - compare$Cheatgrass.Cover, compare$cwd_normal_cum, method = \"pearson\",\n         alternative = \"two.sided\", exact = FALSE)\n#linear mode of log change ~ delta pdc and cwd\ncompare$log_cg_change <- log(I(compare$Cheatgrass/100 - compare$Cheatgrass.Cover/100 - min(compare$Cheatgrass/100 - compare$Cheatgrass.Cover/100) + .01))\ncg_change_lm <- lm(log_cg_change ~ Delta_pdc*cwd_normal_cum, data= compare[-c(5,10),])\n\n\n\n\n#seeing how far out these outliers are\nsd(compare$log_cg_change[-c(5,10)])\nmean(compare$log_cg_change[-c(5,10)])\n(compare$log_cg_change[c(5)] - 1.72) / .18\n(compare$log_cg_change[c(10)] - 1.72) / .18\n\n\nsummary(cg_change_lm)\nplot(cg_change_lm)\nplot(allEffects(cg_change_lm, partial.residuals = TRUE))\n\n#Perr grass\nplot(compare$Pgrass ~ compare$Perrenial.Grass.Cover)\nsummary(lm(compare$Pgrass ~ compare$Perrenial.Grass.Cover + 0))\ncor.test(compare$Pgrass, compare$Perrenial.Grass.Cover,\n         method = c(\"spearman\"), exact = FALSE)\nboxplot(log(compare$Pgrass/compare$Perrenial.Grass.Cover))\nmean(compare$Pgrass-compare$Perrenial.Grass.Cover)\nt.test(compare$Pgrass, compare$Perrenial.Grass.Cover, paired = TRUE, alternative=\"less\")\nwilcox.test(compare$Pgrass, compare$Perrenial.Grass.Cover, paired = TRUE, alternative=\"less\")\n\npg_change_lm <- lm(Pgrass - Perrenial.Grass.Cover ~ Delta_pdc*cwd_normal_cum, data= compare[-5,])\nsummary(pg_change_lm)\n\n## Perr forb\nplot(I(compare$Aforb + compare$Pforb) ~ compare$Forb.Cover)\nsummary(lm(I(compare$Aforb + compare$Pforb) ~ compare$Forb.Cover + 0))\ncor.test(I(compare$Aforb + compare$Pforb), compare$Forb.Cover,\n         method = c(\"spearman\"), exact = FALSE)\nboxplot(I(compare$Aforb + compare$Pforb) - compare$Forb.Cover)\nmean(I(compare$Aforb + compare$Pforb) - compare$Forb.Cover)\nt.test(I(compare$Aforb + compare$Pforb), compare$Forb.Cover, paired = TRUE, alternative=\"less\")\nwilcox.test(I(compare$Aforb + compare$Pforb), compare$Forb.Cover, paired = TRUE, alternative=\"less\")\n\npf_change_lm <- lm(Aforb + Pforb - Forb.Cover ~ Delta_pdc*cwd_normal_cum, data= compare[-5,])\nsummary(pf_change_lm)\n\n## Shrub\nplot(compare$Shrub ~ I(compare$Shrub.Cover.Total))\n  abline(0,1)\nsummary(lm(compare$Shrub ~ I(compare$Shrub.Cover.Total) + 0))\ncor.test(compare$Shrub, compare$Shrub.Cover.Total,\n         method = c(\"spearman\"), exact = FALSE)\nboxplot(compare$Shrub - compare$Shrub.Cover.Total)\nmean(compare$Shrub - compare$Shrub.Cover.Total)\nt.test(compare$Shrub, compare$Shrub.Cover.Total, paired = TRUE, alternative=\"less\")\nwilcox.test(compare$Shrub, compare$Shrub.Cover.Total, paired = TRUE, alternative=\"less\")\nhist(compare$Shrub - I(compare$Shrub.Cover.Total))\n\ns_change_lm <- lm(Shrub - Shrub.Cover.Total ~ Delta_pdc*cwd_normal_cum, data= compare[-5,])\nsummary(s_change_lm)\n\n######################\n# Plot of comparisons between 2005 and 2015\n######################\nopar <- par(no.readonly = TRUE)\n\npng(filename=\"change_in_cover.png\", \n    type=\"cairo\",\n    units=\"in\", \n    width = 4, \n    height=4, \n    pointsize=12, \n    res=160)\n\nlayout(matrix(c(1,2,3,4), nrow = 2, ncol = 2, byrow = TRUE))\n\npar(oma = c(2,2,0,0), family = \"serif\", bty = 'n')\n\n\npar(mar = c(2,2,2,1))\nplot(compare$Pgrass ~ compare$Perrenial.Grass.Cover, xlim = c(0,35), ylim = c(0, 35),\n     xlab = \"\", ylab = \"\", main = \"Perennial Grass\", xaxt = 'n', yaxt = 'n',\n     bg='grey60',\n     col = 'grey30',\n     pch = 21,\n     cex = 1.5,\n     cex.axis = .8,\n     cex.main = 1.3)\n  axis(side = 1, at = c(0,10,20,30), labels = TRUE)\n  axis(side = 1, at = c(0,5,15,25,35), tcl = -.24, labels = FALSE)\n  axis(side = 2, at = c(0,10,20,30), labels = TRUE)\n  axis(side = 2, at = c(0,5,15,25,35), tcl = -.24, labels = FALSE)\n  abline(0,1, lty = 2, col = 'grey30')\n  \npar(mar = c(2,2,2,1))\nplot(compare$Pforb ~ compare$Forb.Cover, xlim = c(0, 12), ylim = c(0, 12),\n     main = \"Perennial Forb\", xlab = \"\", ylab = \"\", xaxt = 'n', yaxt = 'n',\n     bg='grey60',\n     col = 'grey30',\n     pch = 21,\n     cex = 1.5,\n     cex.axis = .8,\n     cex.main = 1.3)\n  axis(side = 1, at = c(0,4,8,12), labels = TRUE)\n  axis(side = 1, at = c(0,2,6,10), tcl = -.25, labels = FALSE)\n  axis(side = 2, at = c(0,4,8,12), labels = TRUE)\n  axis(side = 2, at = c(0,2,6,10), tcl = -.25, labels = FALSE)\n  abline(0,1, lty = 2, col = 'grey30')\n  \n\npar(mar = c(2,2,2,1))\nplot(compare$Shrub ~ compare$Shrub.Cover.Total, xlim = c(0, 30), ylim = c(0,30),\n     xlab = \"\", ylab = \"\", main = \"Shrub\",xaxt = 'n', yaxt = 'n',\n     bg='grey60',\n     col = 'grey30',\n     pch = 21,\n     cex = 1.5,\n     cex.axis = .8,\n     cex.main = 1.3)\n  axis(side = 1, at = c(0,10,20,30), labels = TRUE)\n  axis(side = 1, at = c(0,5,15,25), tcl = -.25, labels = FALSE)\n  axis(side = 2, at = c(0,10,20,30), labels = TRUE)\n  axis(side = 2, at = c(0,5,15,25), tcl = -.25, labels = FALSE)\n  abline(0,1, lty = 2, col = 'grey30')\n  \n\npar(mar = c(2,2,2,1))\nplot(compare$Cheatgrass ~ compare$Cheatgrass.Cover, xlim = c(0, 20), ylim = c(0, 20),\n     xlab = \"\", ylab = \"\", main = \"Cheatgrass\", xaxt = 'n', yaxt = 'n',\n     bg='grey60',\n     col = 'grey30',\n     pch = 21,\n     cex = 1.5,\n     cex.axis = .8,\n     cex.main = 1.3)\n  axis(side = 1, at = c(0,5,10,15,20), labels = TRUE)\n  axis(side = 1, at = c(0,2.5,7.5,12.5,17.5), tcl = -.25, labels = FALSE)\n  axis(side = 2, at = c(0,5,10,15,20), labels = TRUE)\n  axis(side = 2, at = c(0,2.5,7.5,12.5,17.5), tcl = -.25, labels = FALSE)\n  abline(0,1, lty = 2, col = 'grey30')\n  \nmtext(\"2005 Cover (%)\", side = 1, outer = TRUE)\nmtext(\"2015 Cover (%)\", side = 2, outer = TRUE)\ndev.off()\n\npar(opar)\n\n#-----------------------------------------------------------------\n## Aggregating by cluster\n#-----------------------------------------------------------------\nlibrary(car)\nag_data <- aggregate(plot_data, by = list(plot_data$Cluster), FUN = mean)\n\n#---------------------------------------------------------\nag_data$log_cg <- log(ag_data$Cheatgrass/100 + .01)\n\ncheatgrass_ag <- lm(log(ag_data$Cheatgrass/100 + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                      scale(AWC), data = ag_data, \n                        na.action = na.fail)\nsummary(cheatgrass_plot)\nsummary(cheatgrass_ag)\nplot(allEffects(cheatgrass_ag))\ncg_ag_set <- dredge(cheatgrass_ag)\nhead(cg_ag_set)\ncg_best <- lm(log(Cheatgrass/100 + .01) ~ scale(cwd_normal_cum)*scale(Delta_pdc) + scale(Tree_cover),\n              data = ag_data)\nsummary(cg_best)\n\ncg_avg <- model.avg(get.models(cg_ag_set, subset = delta <4), fit = TRUE)\nsummary(cg_avg)\n\nvif(cheatgrass_ag)\n#---------------------------------------------------\n\npgrass_ag <- lm(log(Pgrass/100 + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                  scale(AWC), data = ag_data, \n                    na.action = na.fail)\nsummary(pgrass_plot)\nsummary(pgrass_ag)\n\npgrass_ag_set <- dredge(pgrass_ag)\nhead(pgrass_ag_set)\npgrass_best <- lm(log(Pgrass/100 + .01) ~ scale(Delta_pdc), data = ag_data, \n                  na.action = na.fail)\nsummary(pgrass_best)\n\npg_avg <- model.avg(get.models(pgrass_ag_set, subset = delta <4), fit = TRUE)\nsummary(pg_avg)\n\nvif(pgrass_ag)\n\n#-------------------------------------------\npforb_ag <- lm(log(Pforb/100 + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                 scale(AWC), data = ag_data, \n                na.action = na.fail)\n\nsummary(pforb_plot)\nsummary(pforb_ag)\npforb_ag_set <- dredge(pforb_ag)\nhead(pforb_ag_set)\npforb_best <- lm(log(Pforb/100 + .01) ~ scale(Tree_cover) + scale(AWC), data = ag_data)\nsummary(pforb_best)\n\npf_avg <- model.avg(get.models(pforb_ag_set, subset = delta <4), fit = TRUE)\nsummary(pf_avg)\n\nplot(allEffects(pforb_ag, partial.residuals = TRUE))\n#---------------------------------------------------------\naforb_ag <- lm(log(Aforb/100 + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                 scale(AWC), data = ag_data, \n               na.action = na.fail)\n\nsummary(aforb_ag)\npforb_ag_set <- dredge(pforb_ag)\nhead(pforb_ag_set)\npforb_best <- lm(log(Pforb/100 + .01) ~ scale(Tree_cover) + scale(AWC), data = ag_data)\nsummary(pforb_best)\n\npf_avg <- model.avg(get.models(pforb_ag_set, subset = delta <4), fit = TRUE)\nsummary(pf_avg)\n\nplot(allEffects(pforb_ag, partial.residuals = TRUE))\n\n\n#--------------------------------------------------------\n\nshrub_ag <- lm(log(Shrub_cover_li + .01) ~ scale(Tree_cover) + scale(Delta_pdc)*scale(cwd_normal_cum) +\n                 scale(AWC), data = ag_data, \n               na.action = na.fail)\nsummary(shrub_plot)\nsummary(shrub_ag)\n\n\nshrub_ag_set <- dredge(shrub_ag)\nhead(shrub_ag_set)\nshrub_best <- lm(log(Shrub_cover_li/100 + .01) ~ scale(Tree_cover), data = ag_data)\nsummary(shrub_best)\n\nshrub_avg <- model.avg(get.models(shrub_ag_set, subset = delta <4), fit = TRUE)\nsummary(shrub_avg)\n\n\nplot(allEffects(shrub_ag, partial.residuals = TRUE))\n\n\n",
    "created" : 1470411760793.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "918025343",
    "id" : "17C5942F",
    "lastKnownWriteTime" : 1468188133,
    "path" : "C:/Users/sflake/Google Drive/Thesis related/Understory/plot_level_understory.R",
    "project_path" : "plot_level_understory.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}